# GXS通讯协议

## USART标准

115200, 8 bits, 1 stop, none 校验位

## 协议格式

- 定长7个字节, 以0x75开头, 校验字节
- `0x75, 指令(CMD), 参数1(ARG1), 参数2(ARG2), 参数3(ARG3), 参数4(ARG4), 校验字节`
- 乙方每发送一次控制命令都要等待另一方发送通用确认码，每收到一次命令都要回复通用确认码

### 通用确认码(0x00)

> 0x75, 0x00, 结果, 原始CMD, 原始校验字节, 00, 校验  
> 结果(第三个字节)为确认状态，0x00表示正确完成,  
> 0xff 代表不认识的命令或者参数有问题,  
> 0x01 代表命令没问题，但是无法做到  
> 原始校验字节 用 和校验 (把 CMD, ARG1, ARG2, ARG3, ARG4 加一遍)然后位与0xFF

如 上->下 发命令 `75 01 00 00 00 00 01`  
则 下->上 回应 `75 00(表示确认码) 00(成功) 01(原始的CMD) 01(原始校验和) 00 02`

### 左偏转(0x01)

- 方向: 上->下
- ARG1: 偏转幅度(相对大小,不是角度), 取值范围`[0,100]`
- 示范: `75 01 幅度 00 00 00 XX` (XX 为校验)

### 右偏转(0x02)

- 方向: 上->下
- ARG1: 偏转幅度(相对大小,不是角度), 取值范围`[0,100]`
- 示范: `75 02 幅度 00 00 00 XX` (XX 为校验)

### 左平移(0x03)

- 方向: 上->下
- ARG1: 平移幅度(相对大小,不是距离), 取值范围`[0,100]`
- 示范: `75 03 幅度 00 00 00 XX` (XX 为校验)

### 右平移(0x04)

- 方向: 上->下
- ARG1: 平移幅度(相对大小,不是距离), 取值范围`[0,100]`
- 示范: `75 04 幅度 00 00 00 XX` (XX 为校验)

### 右大转弯(0x05)

- 方向: 上->下
- 上位机告知下位机开始右转弯
- 示范: `75 05 00 00 00 00 XX` (XX 为校验)

### 直行(0x07)

- 方向: 上->下
- 上位机告知下位机直行(右转弯结束)
- 示范: `75 07 00 00 00 00 XX` (XX 为校验)

### 停止(0x08)

- 方向: 上->下
- AUX关闭所有推进器
- 示范: `75 08 00 00 00 00 XX` (XX 为校验)

### 报点(0x10)

- 方向: 上->下
- 上位机告知下位机检测到漏点
- ARG1: 吸附物计数 (从1开始)
- ARG2: 吸附物形状 (1.方形 2.圆形)
- 示范: `75 10 计数 形状 00 00 XX` (XX 为校验)

### 获取AUV电池电压(0x20)

- 方向: 上->下
- 上位机向下位机下位机询问电池电压
- 示范:

> 请求 上->下 `75 20 00 00 00 00 XX` (XX 为校验)  
> 回应 下->上 `75 00(表示确认码) 00(成功) 20(原始的CMD) HH LL XX` (XX 为校验)  
> 其中 `HH LL` 构成一个 `unsigned short` 大端整数表示电压, 三位小数, 其值为 `(unsigned short)(电压*1000)`

### 自检(0x20)

还没写, 空着就行
