# GXS通讯协议

## USART标准

115200, 8 bits, 1 stop, none 校验位

## 协议格式

- 定长7个字节, 以0x75开头, 校验字节
- `0x75, 指令(CMD), 参数1(ARG1), 参数2(ARG2), 参数3(ARG3), 参数4(ARG4), 校验字节`
- 乙方每发送一次控制命令都要等待另一方发送通用确认码，每收到一次命令都要回复通用确认码

### 通用确认码(0x00)

> 0x75, 0x00, 结果, 原始CMD, 原始校验字节, 00, 校验  
> 结果(第三个字节)为确认状态，0x00表示正确完成,  
> 0xff 代表不认识的命令或者参数有问题,  
> 0x01 代表命令没问题，但是无法做到  
> 原始校验字节 用 和校验 (把 CMD, ARG1, ARG2, ARG3, ARG4 加一遍)然后位与0xFF

如 上->下 发命令 `75 01 00 00 00 00 01`  
则 下->上 回应 `75 00(表示确认码) 00(成功) 01(原始的CMD) 01(原始校验和) 00 02`

### 报点(0x10)

- 方向: 上->下
- 上位机告知下位机检测到漏点
- ARG1: 吸附物计数 (从1开始)
- ARG2: 吸附物形状 (1.方形 2.圆形)
- 示范: `75 10 计数 形状 00 00 XX` (XX 为校验)

### 获取AUV电池电压(0x21)

- 方向: 上->下
- 上位机向下位机下位机询问电池电压
- 示范:

> 请求 上->下 `75 21 00 00 00 00 XX` (XX 为校验)  
> 回应 下->上 `75 00(表示确认码) 00(成功) 21(原始的CMD) HH LL XX` (XX 为校验)  
> 其中 `HH LL` 构成一个 `unsigned short` 大端整数表示电压, 三位小数, 其值为 `(unsigned short)(电压*1000)`

### 自检(0x20)

还没写, 空着就行

### 运动控制(0x30)

- 方向: 上->下
- 上位机告知下位机X,Y,Z三轴平移相对速度及自转(W)相对速度
- XX: 平移轴, 后-前+, 取值范围`int8_t [-100,+100]`
- YY: 平移轴, 左-右+, 取值范围`int8_t [-100,+100]`
- ZZ: 平移轴, 下-上+, 取值范围`int8_t [-100,+100]`
- WW: 垂直轴自转, 俯视时顺+逆-, 取值范围`int8_t [-100,+100]`
- 示范: `75 30 XX YY ZZ WW CC` (CC 为校验)
- 备注: 若在3s内下位机没有收到上位机任何有效指令, 则停止所有运动
